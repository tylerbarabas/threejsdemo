<html>
<head>
  <script src="js/build/three.js"></script>
</head>
<body>
<script>
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

var renderer = new THREE.WebGLRenderer();
renderer.setSize( window.innerWidth, window.innerHeight );
document.body.appendChild( renderer.domElement );

var skyGeometry = new THREE.BoxGeometry( 1, 1, 1 );
var loader = new THREE.CubeTextureLoader();
var path = "js/examples/textures/cube/Park3Med/";
var format = '.jpg';
var urls = [
    path + 'px' + format, path + 'nx' + format,
    path + 'py' + format, path + 'ny' + format,
    path + 'pz' + format, path + 'nz' + format
  ];
var textureCube = loader.load([
  urls[1],
  urls[0],
  urls[3],
  urls[2],
  urls[4],
  urls[5]
]);

var skyMaterial = new THREE.MeshBasicMaterial({
  color: 0xffffff,
  envMap: textureCube,
  side: THREE.BackSide
});
var skyCube = new THREE.Mesh( skyGeometry, skyMaterial );
skyCube.scale.set(400,400,400);
scene.add( skyCube );
camera.rotation.y = Math.PI;

var demoMaterial = new THREE.MeshPhongMaterial( { color: 0xffa500, specular: 0x009900, shininess: 30, shading: THREE.SmoothShading } );
var demoCube = new THREE.Mesh( skyGeometry, demoMaterial);
demoCube.position.z = 20;
scene.add(demoCube);

var light = new THREE.AmbientLight( 0xFFFFFF ); // soft white light
scene.add( light );

var listener = new THREE.AudioListener();
camera.add( listener );
var audioLoader = new THREE.AudioLoader();
var sound1 = new THREE.PositionalAudio( listener );
audioLoader.load( 'demosong.mp3', function( buffer ) {
  sound1.setBuffer( buffer );
  sound1.setRefDistance( 10 );
  sound1.source.loop = true;
  sound1.play();
});
demoCube.add( sound1 );

window.addEventListener('keydown',function(e){
  switch (e.which) {
    case 37: camera.rotation.y += 0.1;
      break;
    case 38: camera.rotation.x += 0.1;
      break;
    case 39: camera.rotation.y -= 0.1;
      break;
    case 40: camera.rotation.x -= 0.1;
      break;
  }
});

var direction = 1;
var xDirection = 1;
var stop = false;
var render = function () {
    requestAnimationFrame( render );

    demoCube.rotation.z += 0.1;
    demoCube.rotation.x += 0.1;

    demoCube.position.x += 1*xDirection;
    if (demoCube.position.x > 20 || demoCube.position.x < -20) {
      xDirection *= -1;
    }
    if (!stop) {
      demoCube.position.z += 3*direction;
    }
    if (demoCube.position.z > 200) {
      stop = true;
      demoCube.position.z = 200;
      setTimeout(function(){
        stop = false;
        direction *= -1;
      }, 3000);
    }
    if (demoCube.position.z < 2) {
      stop = true;
      demoCube.position.z = 2;
      setTimeout(function(){
        stop = false;
        direction *= -1;
      }, 3000);
    }

    skyCube.position.copy(camera.position);

    renderer.render(scene, camera);
};

render();

</script>
</body>
</html>
